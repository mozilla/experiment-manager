# Generated by Django 3.0.4 on 2020-04-06 23:36

import django.contrib.postgres.fields
from django.db import migrations, models
import experimenter.experiments.models


def forward_platform_string_to_array(apps, schema_editor):
    Experiment = apps.get_model("experiments", "Experiment")

    for experiment in Experiment.objects.all():
        experiment.platforms = [experiment.platform]
        experiment.save()


def reverse_platform_string_to_array(apps, schema_editor):
    Experiment = apps.get_model("experiments", "Experiment")

    for experiment in Experiment.objects.all():
        experiment.platform = experiment.platforms[0]
        experiment.save()


class Migration(migrations.Migration):

    dependencies = [
        ("experiments", "0089_experiment_total_enrolled_clients"),
    ]

    operations = [
        migrations.AddField(
            model_name="experiment",
            name="platforms",
            field=django.contrib.postgres.fields.ArrayField(
                base_field=models.CharField(max_length=200),
                blank=True,
                default=experimenter.experiments.models.default_all_platforms,
                null=True,
                size=None,
            ),
        ),
        migrations.RunPython(
            forward_platform_string_to_array, reverse_platform_string_to_array
        ),
        migrations.RemoveField(model_name="experiment", name="platform",),
    ]
